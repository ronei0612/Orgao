var accessToken;const clientId="982717214287-u57uddj8lrd7dq0n5i4fquuvci8umd60.apps.googleusercontent.com",redirectUri="https://"+window.location.host+"/orgao",scope="https://www.googleapis.com/auth/drive";function authorizeGoogle(){let e=`https://accounts.google.com/o/oauth2/auth?client_id=982717214287-u57uddj8lrd7dq0n5i4fquuvci8umd60.apps.googleusercontent.com&redirect_uri=${redirectUri}&response_type=token&scope=${encodeURIComponent("https://www.googleapis.com/auth/drive")}`;window.location.href=e}async function processToken(){let e=new URLSearchParams(window.location.hash.substr(1)),o=e.get("access_token");o?(localStorage.setItem("accessToken",o),localStorage.setItem("accessTokenExpiry",Date.now()+36e5)):console.error("Erro ao obter o token de acesso ou ID da pasta.")}function verificarSeObtendoTokenGoogle(){window.location.href.includes("#access_token")&&(processToken(),localStorage.getItem("accessToken")&&(document.location.hash=""))}async function criarArquivoNoGoogleDrive(e,o){try{let t=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({name:e,mimeType:"text/txt"})});if(t.ok){let a=await t.json(),r=a.id,i=`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=media`;if((t=await fetch(i,{method:"PATCH",headers:{Authorization:`Bearer ${accessToken}`,"Content-Type":"text/plain"},body:o})).ok){let n=`https://www.googleapis.com/drive/v3/files/${r}/permissions`;(t=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})})).ok?(localStorage.setItem("fileId",r),localStorage.setItem("nomeCompartilhamento",e),mostrarModal("compartilhado")):console.error("Erro ao compartilhar o arquivo:",t.statusText)}else console.error("Erro ao adicionar texto ao arquivo:",t.statusText)}else console.error("Erro ao criar o arquivo:",t.statusText)}catch(c){console.error("Erro ao criar o arquivo:",c)}}async function criarArquivodoStorage(){let e=verificarSeJaCompartilhado();if(""!==e){if(await validarToken()){let o=criptografarTexto(e);localStorage.setItem("compartilhadoMD5",o);let t=prompt("Nome do compartilhamento");""!==t&&null!==t&&criarArquivoNoGoogleDrive(t,e)}}else mostrarModal("compartilhado")}async function validarToken(){accessToken=localStorage.getItem("accessToken");let e=localStorage.getItem("accessTokenExpiry");if(!accessToken)return confirm("Conectando \xe0 conta Google para obter autoriza\xe7\xe3o")&&authorizeGoogle(),!1;e&&!(Date.now()<parseInt(e))&&localStorage.removeItem("accessToken");try{let o=await fetch(`https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`);if(!o.ok)throw Error("Erro ao validar o token:",o.status);await o.json()}catch(t){return console.error(t),localStorage.removeItem("accessToken"),confirm("Conectando \xe0 conta Google para obter autoriza\xe7\xe3o")&&authorizeGoogle(),!1}return!0}function carregarSalvosLocalStorage(){let e=localStorage.getItem("salvamentosv2"),o=e.split(",");o.shift();var t="";if(o&&o.length>0){let a={};o.forEach(e=>{let o=localStorage.getItem(e);a[e]=o});let r=JSON.stringify(a);t=r}return t}function criptografarTexto(e){return CryptoJS.MD5(e).toString()}function verificarSeJaCompartilhado(){let e=localStorage.getItem("fileId");"undefined"===e&&localStorage.removeItem("compartilhadoMD5");let o=localStorage.getItem("salvamentosv2"),t=criptografarTexto(o),a=localStorage.getItem("compartilhadoMD5");return a&&e&&t===a?"":o}function copiarTextoParaClipboard(e){var o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),alert("Texto copiado! Cole onde quiser."),ocultarModal()}function compartilharMobile(e){navigator.share?navigator.share({title:"Compartilhar",text:e}).then(()=>console.log("Conte\xfado compartilhado!")).catch(e=>console.error("Erro ao compartilhar:",e)):window.location.href="https://api.whatsapp.com/send?text="+e}function verificarSewww(){window.location.href.includes("localhost")||window.location.href.includes("https://www.")||(window.location.href="https://www."+window.location.host.replace("www.","")+window.location.pathname)}